<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://binnes.github.io/esp8266Workshop/part3/CLOUDANT/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Database - ESP8266 IoT Workshop</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="../..">ESP8266 IoT Workshop</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Part 1 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../part1/" class="dropdown-item">Intro</a>
</li>
                                    
<li>
    <a href="../../part1/PREREQ/" class="dropdown-item">Setup for the Workshop</a>
</li>
                                    
<li>
    <a href="../../part1/FIRSTAPP/" class="dropdown-item">Intro to ESP8266</a>
</li>
                                    
<li>
    <a href="../../part1/WIFI/" class="dropdown-item">ESP8266 WiFi</a>
</li>
                                    
<li>
    <a href="../../part1/LED/" class="dropdown-item">LED Light</a>
</li>
                                    
<li>
    <a href="../../part1/DHT/" class="dropdown-item">Sensor</a>
</li>
                                    
<li>
    <a href="../../part1/IOTCLOUD/" class="dropdown-item">IBM Cloud</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Part 2 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../part2/" class="dropdown-item">Intro</a>
</li>
                                    
<li>
    <a href="../../part2/DEVICE/" class="dropdown-item">Device setup on Cloud</a>
</li>
                                    
<li>
    <a href="../../part2/APP/" class="dropdown-item">Creating the ESP8266 Application</a>
</li>
                                    
<li>
    <a href="../../part2/MQTT/" class="dropdown-item">Intro to MQTT</a>
</li>
                                    
<li>
    <a href="../../part2/CERT1/" class="dropdown-item">IoT Security</a>
</li>
                                    
<li>
    <a href="../../part2/CERT2/" class="dropdown-item">Client Certificates</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Part 3 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Intro</a>
</li>
                                    
<li>
    <a href="../NODERED/" class="dropdown-item">Node-RED</a>
</li>
                                    
<li>
    <a href="../DHTDATA/" class="dropdown-item">Sensor Data</a>
</li>
                                    
<li>
    <a href="../DASHBOARD/" class="dropdown-item">Dashboards</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Database</a>
</li>
                                    
<li>
    <a href="../HISTORY/" class="dropdown-item">Historical Data</a>
</li>
                                    
<li>
    <a href="../INTERVAL/" class="dropdown-item">Reporting interval</a>
</li>
                                    
<li>
    <a href="../LED/" class="dropdown-item">Remote LED control</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Part 4 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../part4/" class="dropdown-item">Intro</a>
</li>
                                    
<li>
    <a href="../../part4/STUDIO/" class="dropdown-item">Watson Studio</a>
</li>
                                    
<li>
    <a href="../../part4/TRAINING/" class="dropdown-item">Create Training Data</a>
</li>
                                    
<li>
    <a href="../../part4/JUPYTER/" class="dropdown-item">Jupyter Notebooks</a>
</li>
                                    
<li>
    <a href="../../part4/MODEL/" class="dropdown-item">Run model on device</a>
</li>
                                    
<li>
    <a href="../../part4/SUMMARY/" class="dropdown-item">Workshop Summary</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../DASHBOARD/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../HISTORY/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/binnes/esp8266Workshop/edit/master/docs/part3/CLOUDANT.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#store-data-in-cloud-storage-for-historical-data-analytics" class="nav-link">Store Data in Cloud Storage for Historical Data Analytics</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#lab-objectives" class="nav-link">Lab Objectives</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="store-data-in-cloud-storage-for-historical-data-analytics">Store Data in Cloud Storage for Historical Data Analytics</h1>
<h2 id="lab-objectives">Lab Objectives</h2>
<p>In this lab you will store the device environmental sensor data in a Cloudant database in IBM Cloud.  You will learn:</p>
<ul>
<li>How to create a Node-RED flow that uses the Cloudant node</li>
<li>How to format a time series database record</li>
<li>How to view Cloudant databases</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>While real-time charts of sensor data and threshold alerts are useful, the power of IoT becomes significant when data analytics techniques, Machine Learning and AI are applied to the IoT historical datasets.  The first and necessary step toward data analytics is storing the incoming data in a Cloud data storage database for later statistical modelling.</p>
<h3 id="step-1-import-the-node-red-cloudant-storage-flow">Step 1 - Import the Node-RED Cloudant Storage Flow</h3>
<p>Open the “Get the Code” github URL listed below, mark or Ctrl-A to select all of the text, and copy the text for the flow to your Clipboard. Recall from a previous section, click on the Node-RED Menu, then Import, then Clipboard. Paste the text of the flow into the Import nodes dialog and press the red Import button.</p>
<p>Node-RED Cloud Storage Flow : <a href="../flows/NR-Cloudant-DHTSensorData.json">Get the Code</a></p>
<p>You will need to verify the configuration of the <strong>mqtt in</strong> node to use your configuration, as you did in the previous section.</p>
<h3 id="step-2-store-iot-sensor-data-with-node-red">Step 2 - Store IoT Sensor Data with Node-RED</h3>
<p>In this Step you will use Node-RED to store IoT Sensor data from the ESP8266 DHT environmental sensors in a Cloudant database.</p>
<ul>
<li>When the flow is imported there will be a misconfigured Cloudant node – indicated by a red triangle.
 <img alt="Node-RED Cloudant Flow cropped" src="../screenshots/Node-RED-Cloudant-flow-cropped.png" /></li>
<li>
<p>To associate the <strong>Cloudant</strong> database node with your IBM Cloud instance, double-click on the historical data Cloudant node and press the red Done button. The red error triangle will turn blue.
 <img alt="Node-RED Cloudant Flow cropped" src="../screenshots/Node-RED-Cloudant-flow-config.png" /></p>
</li>
<li>
<p>The <em>Format Time Series DB Record</em> function node recasts the ESP8266 DHT JSON object. As required by any time series dataset, the Node-RED function node adds a timestamp to the record before writing it to the Cloudant storage. Note in the screenshot, the debug sidebar shows a <code>msg.payload</code> that includes the Epoch timestamp (milliseconds since Jan 1 1970)
 <img alt="Node-RED Cloudant Flow cropped" src="../screenshots/Node-RED-Cloudant-flow-timeseries.png" /></p>
</li>
<li>Click the <strong>Deploy</strong> button on the top of menu bar to deploy the Node-RED flow.</li>
<li>The device environmental sensor data is now being recorded in a Cloudant database.</li>
</ul>
<h3 id="step-3-observe-sensor-data-being-added-to-the-cloudant-database">Step 3 - Observe Sensor Data being added to the Cloudant database</h3>
<ul>
<li>Return to the <a href="https://cloud.ibm.com/dashboard/apps/">IBM Cloud dashboard</a> and your IoT Starter application. <strong>Click</strong> on the cloudantNoSQLDB service connection:
 <img alt="Cloudant NoSQL Service Connection" src="../screenshots/CloudantNoSQLServiceConnection.png" /></li>
<li>The database linked to your application is an alias link to the actual database instance, so select the link to get to the actual database instance: <img alt="Database alias link" src="../screenshots/CloudantNoSQLServiceAlias.png" /></li>
<li>Read about the Cloudant Storage service and press the <strong>Launch</strong> button:
 <img alt="Cloudant NoSQL Service Instance" src="../screenshots/CloudantNoSQLServiceInstance.png" /></li>
<li>The IoT Sensor device data is stored in the Cloudant service.
 <img alt="Cloudant NoSQL Databases" src="../screenshots/CloudantNoSQLDatabases.png" /></li>
<li>Click on historicaldata1 and then observe the <strong>Table</strong> view of temperature, humidity and timestamp data:
 <img alt="Cloudant NoSQL Historian Data" src="../screenshots/CloudantNoSQLHistorianDB.png" /></li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
